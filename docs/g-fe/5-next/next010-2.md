---
sidebar_position: 10
---


# Supabase Client


- 아래 예시는 actions를 이용한 예이다.  
- "use server"; 및 비동기 함수로 정의하자.  

## SELECT

```js
"use server";
import { createServerSideClient } from "@/lib/supabase";

export const getTodosPublic = async () => {
  const supabase = await createServerSideClient();
  const result = await supabase
    .from("todos-public")
    .select("*")
    .is("deleted_at", null)
    .order("id", { ascending: false });

  // this make error.jsx show
  //   throw new Error("custom error");
  //   return;
  //   if (result.error)
  return result.data;
};

export const getTodosPublicById = async (id: number) => {
  const supabase = await createServerSideClient();
  const result = await supabase
    .from("todos-public")
    .select("*")
    .is("deleted_at", null)
    .eq("id", id);

  return result.data?.[0];
};


export const getTodosPublicBySearch = async (terms: string) => {
  const supabase = await createServerSideClient();
  const result = await supabase
    .from("todos-public")
    .select("*")
    .is("deleted_at", null)
    .ilike("content", `%${terms}%`);

  return result.data;
};
```

## Mutation  

- update는 eq로 선택 + update안에는 업데이트 할 내용을 적어준다.  
- softDelete는 string타입(ISO)으로 삭제된 날짜를 넘겨주면서 구현한다.  

```js
export const createTodosPublic = async (content: string) => {
  const supabase = await createServerSideClient();
  const result = await supabase
    .from("todos-public")
    .insert({ content })
    .select();

  return result.data;
};

export const updateTodosPublic = async (id: number, content: string) => {
  const supabase = await createServerSideClient();
  const result = await supabase
    .from("todos-public")
    .update({ content, updated_at: new Date().toISOString() })
    .eq("id", id)
    .select();

  return result.data;
};

export const deleteTodosPublicSoft = async (id: number) => {
  const supabase = await createServerSideClient();
  const result = await supabase
    .from("todos-public")
    .update({ deleted_at: new Date().toISOString() })
    .eq("id", id)
    .select();
  return result.data;
};

export const deleteTodosPublicHard = async (id: number) => {
  const supabase = await createServerSideClient();
  const result = await supabase.from("todos-public").delete().eq("id", id);

  return result.data;
};

```